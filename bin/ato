#!/bin/bash

# Define the Docker image name to use
IMAGE_NAME="atopile-local"

prepare_env_args() {
    local prefix=$1
    local env_args=""
    for var_name in $(compgen -v "$prefix"); do
        env_args+=" --env $var_name"
    done
    echo "$env_args"
}

ATO_ENV_ARGS=$(prepare_env_args "ATO_")
GITHUB_ENV_ARGS=$(prepare_env_args "GITHUB_")
GIT_ENV_ARGS=$(prepare_env_args "GIT_")

# Run the command inside the container
docker run --rm -i \
    -e NONINTERACTIVE=1 \
    --env ACTIONS_ID_TOKEN_REQUEST_URL \
    --env ACTIONS_ID_TOKEN_REQUEST_TOKEN \
    ${ATO_ENV_ARGS} \
    ${GITHUB_ENV_ARGS} \
    ${GIT_ENV_ARGS} \
    -v "$(pwd)":"$(pwd)" \
    -w "$(pwd)" \
    --entrypoint ato \
    "${IMAGE_NAME}" \
    "$@" # Pass all script arguments to the container's entrypoint
